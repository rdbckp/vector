name: Corel-Style Color to BW Pro (URL)

on:
  workflow_dispatch:
    inputs:
      image_url:
        description: 'Tempel Link URL Gambar'
        required: true
      brightness:
        description: 'Brightness (-100 s/d 100)'
        default: '0'
        required: true
      contrast:
        description: 'Contrast (-100 s/d 100)'
        default: '0'
        required: true
      threshold_val:
        description: 'Line Art Threshold (0-255) - Corel Default is 128 (50%)'
        default: '128'
        required: true

jobs:
  convert-bw-pro:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install ImageMagick
        run: sudo apt-get update && sudo apt-get install -y imagemagick

      - name: Process Image (Corel X5 Line Art Logic)
        run: |
          # 1. Download Gambar
          curl -L "${{ github.event.inputs.image_url }}" -o "source_image"
          
          if [ ! -s "source_image" ]; then
            echo "‚ùå URL error, Bro!"
            exit 1
          fi

          # 2. Eksekusi ala Corel X5:
          # -colorspace gray: Ubah ke 8-bit Grayscale
          # -brightness-contrast: Sesuaikan input user
          # -threshold: Pakai nilai absolut (0-255). 128 itu setara 50% di Corel.
          # -depth 1: Pakai 1-bit biar jadi Line Art murni (item-putih tegas)
          
          convert source_image \
                  -colorspace gray \
                  -brightness-contrast ${{ github.event.inputs.brightness }}x${{ github.event.inputs.contrast }} \
                  -threshold ${{ github.event.inputs.threshold_val }} \
                  -depth 1 \
                  "result_lineart.png"

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "lineart-v${{ github.run_number }}"
          name: "Line Art Result #${{ github.run_number }}"
          body: |
            **Settings Applied:**
            - Brightness: ${{ github.event.inputs.brightness }}
            - Contrast: ${{ github.event.inputs.contrast }}
            - Threshold: ${{ github.event.inputs.threshold_val }}
          files: result_lineart.png
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
