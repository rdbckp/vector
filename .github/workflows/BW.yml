name: Color to Black & White Converter (URL)

on:
  workflow_dispatch:
    inputs:
      image_url:
        description: 'Tempel Link URL Gambarnya (PNG/JPG/JPEG/BMP)'
        required: true
      contrast_boost:
        description: 'Naikin Kontras? (Ketik 0 buat normal, 20-50 buat nendang)'
        default: '20'
        required: true
      output_format:
        description: 'Format Hasil (png atau jpg)'
        default: 'png'
        required: true

jobs:
  convert-bw:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install ImageMagick
        run: sudo apt-get update && sudo apt-get install -y imagemagick

      - name: Download and Convert
        run: |
          # 1. Download gambar pake curl
          curl -L "${{ github.event.inputs.image_url }}" -o "source_image"
          
          # 2. Cek apakah download berhasil
          if [ ! -s "source_image" ]; then
            echo "‚ùå URL-nya ngaco atau gambar gak bisa di-download, Bro!"
            exit 1
          fi

          # 3. Proses ke Black & White
          # -colorspace gray: Ngubah jadi abu-abu
          # -sigmoidal-contrast: Naikin kontras biar item-putihnya tegas (pake input user)
          # -sharpen: Biar detail tetep gahar
          convert source_image \
                  -colorspace gray \
                  -sigmoidal-contrast ${{ github.event.inputs.contrast_boost }}x50% \
                  -sharpen 0x1 \
                  "result_bw.${{ github.event.inputs.output_format }}"

      - name: Create Release and Upload BW
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "bw-v${{ github.run_number }}"
          name: "BW Result #${{ github.run_number }}"
          body: |
            **Image Source:** ${{ github.event.inputs.image_url }}
            **Contrast Boost:** ${{ github.event.inputs.contrast_boost }}
          files: result_bw.${{ github.event.inputs.output_format }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
