name: Corel-Style BW Line Art (URL Input)

on:
  workflow_dispatch:
    inputs:
      image_url:
        description: 'Link URL Gambar'
        required: true
      dpi_resample:
        description: 'Naikin DPI (Contoh: 300, 600, 1200)'
        default: '600'
        required: true
      brightness_val:
        description: 'Brightness (-100 s/d 100)'
        default: '0'
        required: true
      contrast_val:
        description: 'Contrast (-100 s/d 100)'
        default: '0'
        required: true
      threshold_val:
        description: 'Option Threshold (Line Art Mode 1-bit)'
        default: '50'
        required: true

jobs:
  convert-process:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install ImageMagick
        run: sudo apt-get update && sudo apt-get install -y imagemagick

      - name: Execute Corel X5 Logic
        run: |
          # 1. Download Gambar
          curl -L "${{ github.event.inputs.image_url }}" -o "raw_input"

          if [ ! -s "raw_input" ]; then
            echo "‚ùå Gagal download, cek linknya lagi Bro!"
            exit 1
          fi

          # 2. Proses Transformasi (Dino Salto Style)
          # -resample: Naikin DPI
          # -colorspace gray -depth 8: Grayscale 8-bit
          # -brightness-contrast: Sesuai input BCI Corel
          # -threshold: Final 1-bit Line Art mode
          convert raw_input \
                  -density ${{ github.event.inputs.dpi_resample }} \
                  -resample ${{ github.event.inputs.dpi_resample }} \
                  -colorspace gray -depth 8 \
                  -brightness-contrast ${{ github.event.inputs.brightness_val }}x${{ github.event.inputs.contrast_val }} \
                  -threshold ${{ github.event.inputs.threshold_val }}% \
                  -type bilevel \
                  result_lineart.png

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "lineart-v${{ github.run_number }}"
          name: "Line Art Result #${{ github.run_number }}"
          body: |
            **Tuning Specs:**
            - DPI: ${{ github.event.inputs.dpi_resample }}
            - Brightness: ${{ github.event.inputs.brightness_val }}
            - Contrast: ${{ github.event.inputs.contrast_val }}
            - Threshold: ${{ github.event.inputs.threshold_val }}%
          files: result_lineart.png
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
