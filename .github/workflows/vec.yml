name: Image to SVG Vector Line Art

on:
  workflow_dispatch: # Klik manual di tab Actions

jobs:
  convert-process:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Cache Cargo Registry
        uses: actions/cache@v3
        with:
          path: ~/.cargo/registry
          key: ${{ runner.os }}-cargo-vtracer

      - name: Install Vtracer Tool
        run: cargo install vtracer

      - name: Prepare Workspace and Convert
        run: |
          mkdir -p input output
          
          if [ ! -f "input/image_b811fb.png" ]; then
            echo "‚ùå File 'input/image_b811fb.png' tidak ditemukan!"
            exit 1
          fi

          # Eksekusi Vectorization khusus Black and White
          # --colormode bw: cuma pake hitam-putih
          # --hierarchical cutout: bikin background putih jadi transparan (cutout)
          vtracer \
            --input input/image_b811fb.png \
            --output output/logo_vector.svg \
            --mode spline \
            --colormode bw \
            --hierarchical cutout \
            --path_precision 3 \
            --corner_threshold 60 \
            --filter_speckle 4

      - name: Auto-Commit SVG Result
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add output/logo_vector.svg
          git commit -m "Generate Black Line Art SVG [skip ci]" || echo "No changes to commit"
          git push
