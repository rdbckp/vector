name: Image to SVG Vector Pro

on:
  workflow_dispatch: # Klik manual di tab Actions

jobs:
  convert-process:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Izin buat nge-push file SVG balik ke repo
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Cache Cargo Registry
        uses: actions/cache@v3
        with:
          path: ~/.cargo/registry
          key: ${{ runner.os }}-cargo-vtracer

      - name: Install Vtracer Tool
        run: cargo install vtracer

      - name: Prepare Workspace and Convert
        run: |
          # Pastikan folder input ada
          mkdir -p input output
          
          # Cek apakah file gambar ada, kalau ga ada kita kasih peringatan santai
          if [ ! -f "input/image_b811fb.png" ]; then
            echo "‚ùå WADUH! File 'input/image_b811fb.png' nggak ketemu, Bro!"
            echo "Pastikan lo udah upload gambarnya ke folder 'input' dengan nama yang bener."
            exit 1
          fi

          # Eksekusi Vectorization
          vtracer \
            --input input/image_b811fb.png \
            --output output/logo_vector.svg \
            --mode spline \
            --path_precision 3 \
            --corner_threshold 60 \
            --filter_speckle 4 \
            --color_precision 8

      - name: Auto-Commit SVG Result
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add output/logo_vector.svg
          git commit -m "Auto-generate SVG vector from image [skip ci]" || echo "No changes to commit"
          git push
